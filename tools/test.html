<!DOCTYPE html>
<html>
	<head>
		<title>OK Zoomer Test</title>
		<style type="text/css">
			#target {
				background: red;
				width: 400px;
				height: 200px;
				position: absolute;
				top: calc(50% - 100px);
				left: calc(50% - 200px);
			}
		</style>
	</head>
	<body>
		<div id="target" data-scale="1" data-rotation="0">Gesture target</div>
		<script type="module">
			import okzoomer from '../src/index.js';
			let el = document.querySelector('#target');
			const clamp = v => Math.max(0.04, Math.min(32, v));

			function serialize(gesture = {}) {
				let tr = gesture.translation || [0, 0];
				return `
					translate(${tr[0]}, ${tr[1]})
					scale(${gesture.scale || 1}) 
					rotate(${gesture.rotation || 0})`;
			}

			function multiply(ctm, gesture) {
				return {
					translation: [
						ctm.translation[0] + (gesture.translation ? gesture.translation[0] : 0),
						ctm.translation[1] + (gesture.translation ? gesture.translation[1] : 0)
					],
					scale: ctm.scale * (gesture.scale || 1),
					rotation: ctm.rotation + (gesture.rotation || 0)
				};
			}

			let ctm = {
				translation: [0, 0],
				scale: 1,
				rotation: 0
			};

			let initial_ctm;

			okzoomer(el, {
				startGesture(gesture) {
					initial_ctm = { ...ctm };
					ctm = multiply(initial_ctm, gesture || {});
					el.style.transform = serialize(ctm);
					el.style.transformOrigin = `${gesture.origin.x}px ${gesture.origin.y}px`;
				},
				doGesture(gesture = {}) {
					ctm = multiply(initial_ctm, gesture || {});
					el.style.transform = serialize(ctm);
				},
				endGesture(gesture = {}) {
					ctm = multiply(initial_ctm, gesture || {});
					el.style.transform = serialize(ctm);
				}
			});
		</script>
	</body>
</html>
